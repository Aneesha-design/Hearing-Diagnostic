<!DOCTYPE html> 
<html> 
<!-- The following code has been developed by students and/or researchers of the Freshman Research Initiative DIY Diagnostics Stream at The University of Texas at Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only.  Any user of this code does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.
 
THIS CODE SHOULD NOT BE USED TO DIAGNOSE ANY KIND OF MEDICAL CONDITION.
 
 
Authors in chronological order of contribution:
Tim Riedel
Sofia Williams
 
Further Information:
http://diystream.cns.utexas.edu/

Research Educator:
Timothy Riedel
triedel@utexas.edu
 
Brief Description of Goal of Code:
The Goal of this code is to help individuals self diagnose if they have hearing loss. This code should not be a definitive diagnosis, but could help people seek help should they need it. 
 
Known Issues:
Need to ask user for data collection and adjust app visuals
-->

   <head> 
      
	   <title>Hello World</title>  
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <link rel="stylesheet" href="w3.css">
      <link rel="stylesheet" href="w3-colors-flat.css">
   </head> 


<script>
	
	var docMod = document.lastModified;
       alert("This file last modified  " + docMod);
       console.log("This file last modified  " + docMod);
	
	
	function buttonChange(Id, color) {
	document.getElementById(Id.id).style.className= color;
		
	}
	
	
	//imported decibel functions
	function dBFSToGain(dbfs) {  
  	return Math.pow(10, dbfs / 20);
	}
	 
	
	function decibel(freq, decibel,ear){
	let audioCtx = new AudioContext()

	// Create nodes
	let osc = audioCtx.createOscillator()
	let gain = audioCtx.createGain()

	// Set parameters
	osc.frequency.value = freq
	gain.gain.value = decibel
	
	// Schedule parameter changes
	
	// Drop to -12 dBFS at ~1s
	gain.gain.setValueAtTime(decibel, 1 - 0.03);
	gain.gain.linearRampToValueAtTime(dBFSToGain(-70), 3) //changed gain 
		
	//Creating Stereo Panner to Output on L Headphone
	var panNode = audioCtx.createStereoPanner()
	panNode.pan.value = ear
	
	//Connect graph
	osc.connect(gain)
	gain.connect(panNode)
	panNode.connect(audioCtx.destination) 
	
	// Schedule start and stop
	//osc.start()
		osc.start(0)
		panNode.gain.exponentialRampToValueAtTime(
 		0.00001, context.currentTime + 5)
	osc.stop(audioCtx.currentTime + 2)
	}
	
	
	//this function will append data point to list
	var arr = [0,0]
	function data(dec){
		arr.push(dec)
	}
	
	
</script>
<style>	
.body {
     margin: 0em;
}

.page {
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: -100vw;
    overflow-y: auto;
    z-index: 0;
    background-color: hsl(0,0%,100%);
}

  .page:target {
    left: 0vw;
    z-index: 1;
}
</style>
<style>	
	.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 50px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 50px;
  height: 50px;
  background: #4CAF50;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 50px;
  height: 50px;
  background: #4CAF50;
  cursor: pointer;
}
</style>
</head>
	<body>
<div id="header" class="w3-container w3-flat-peter-river">
	<h1>Audiogram Test</h1>
</div>
	
<div id="content" class="w3-container">
	<p>This audiogram exam will help find out if you may have hearing loss and help to tell you the extent of your hearing loss. In order to perform this exam, 
	follow all of the instructions listed below: </p>
	<p> 1. Try to take this test in as quiet of an environment as possible for optimal results. </p>
	<p> 2. This exam must be used with headphones in order to detect changes in the left/right ear. Use the highest quality of headphones that you have to take this test. </p>
	<p> 3. Turn your device's volume to the maximum volume setting. The app will not play sounds as loud as the device's full amplitude, but uses this as a scale to calibrate accurate decibel outputs. </p>
	 <a href="#125" class="w3-btn w3-grey w3-round"> Get Started </a>
	<br> 
	<br>
	<br>
	<br>
	<br> 
	<br>
	<br>
	<br>
	<br>
	<br>
	<p style="color:black;font-size:12px;">The following code has been developed by students and/or researchers of the Freshman Research Initiative DIY Diagnostics Stream at The University of Texas at 		Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only. Any user of this code 			does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.</p>
	<p style="color:black;font-size:12px;">THIS CODE SHOULD NOT BE USED TO DIAGNOSE ANY KIND OF MEDICAL CONDITION.</p>

<div class="page" id="125">
	<div id="header" class="w3-container w3-flat-peter-river">
		<h1>Audiogram Test</h1>
	</div>
	
    	<div id="content" class="w3-container">
	
	<div class="slidecontainer">
 	<p>Begin with the Slider in the first position and adjust it to the next level until you can hear a noise. Once you hear the first noise, do not keep increasing the volume level and answer the next questions. If you need to hear the noise again, drag the slider to the starting position and then back to the desired level. </p>
  	<input type="range" list ="steplist" min="0" max="100" value="0" id="myRange" data-slider-ticks-labels='["$0", "$10", "$20", "$30", "$40", "$50", "$60", "$70", "$80", "$90", "$100"]'>
	</div>

		<datalist id="tickmarks">
  		<option value="0" label="0%"></option>
 		<option value="10" label="10%"></option>
  		<option value="20" label="20%"></option>
  		<option value="30" label="30%"></option>
  		<option value="40" label="40%"></option>
  		<option value="50" label="50%"></option>
  		<option value="60" label="60%"></option>
  		<option value="70" label="70%"></option>
  		<option value="80" label="80%"></option>
  		<option value="90" label="90%"></option>
  		<option value="100" label="100%"></option>
		</datalist>
		
		<datalist id="steplist">
    		<option>0</option>
    		<option>10</option>
   		<option>20</option>
    		<option>30</option>
    		<option>40</option>
		<option>50</option>
   		<option>60</option>
    		<option>70</option>
    		<option>80</option>
		<option>90</option>
		<option>100</option>
		</datalist>
		
	<script>
	var slider = document.getElementById("myRange");
	slider.oninput = function(){
		decibel(125,this.value / 10 ,-1)
	}
	</script>
		
		
	<p> What is the lowest slider level where you could hear the noise? </p> 
	<a id="button1" onclick="yesAdd1(); buttonChange(button1, ".w3-flat-belize-hole")" class="w3-btn w3-black"> 1</a><!--button adds one to yes count-->	
	<a id="button2" onclick="noAdd1();" class="w3-btn w3-black"> 2 </a><!--button adds one to no count-->
	<a onclick="yesAdd1();" class="w3-btn w3-black"> 3 </a><!--button adds one to yes count-->	
	<a onclick="noAdd1();" class="w3-btn w3-black"> 4 </a><!--button adds one to no count-->	
	<a onclick="yesAdd1();" class="w3-btn w3-black"> 5 </a><!--button adds one to yes count-->	
	<a onclick="noAdd1();" class="w3-btn w3-black"> 6 </a><!--button adds one to no count-->	
		
	<p> Where were you able to hear the sound? </p> 
	<a onclick="yesAdd1();" class="w3-btn w3-black"> Left </a><!--button adds one to yes count-->	
	<a onclick="noAdd1();" class="w3-btn w3-black"> Right </a><!--button adds one to no count-->
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<a href="#250" class="w3-btn w3-black"> Next </a> <!--button to take user to the next page-->
		
    	</div>
</div>
	
	
	<div class="page" id="250">
	<div id="header" class="w3-container w3-flat-peter-river">
		<h1>Audiogram Test</h1>
	</div>
	
    	<div id="content" class="w3-container">
        <p>Press the button below to hear the first sound. </p>    
	<a href="#one" onclick="decibel(440,0.5,-1);" class="w3-btn w3-black"> Play </a><!--button starts beeping noise-->
	
	<p> Where did you hear the sound? </p> 
	<a href="#two" onclick="yesAdd1();" class="w3-btn w3-black"> Left </a><!--button adds one to yes count-->	
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> Right </a><!--button adds one to no count-->
    	</div>
</div>
	</div>
	<div class="page" id="500">
	<div id="header" class="w3-container w3-flat-peter-river">
		<h1>Audiogram Test</h1>
	</div>
	
    	<div id="content" class="w3-container">
        <p>Press the button below to hear the first sound. </p>    
	<a href="#one" onclick="decibel_R();" class="w3-btn w3-black"> Play </a><!--button starts beeping noise-->
	
	<p> Were you able to hear the sound? </p> 
	<a href="#two" onclick="yesAdd1();" class="w3-btn w3-black"> Yes </a><!--button adds one to yes count-->	
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> No </a><!--button adds one to no count-->
    	</div>
</div>
	<footer class="w3-bottom w3-container w3-flat-peter-river">
	<p>DIY DIAGNOSTICS!</p>
</footer>

</body>
</html>
