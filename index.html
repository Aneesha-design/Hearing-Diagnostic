<!DOCTYPE html> 
<html> 
<!-- The following code has been developed by students and/or researchers of the Freshman Research Initiative DIY Diagnostics Stream at The University of Texas at Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only.  Any user of this code does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.
 
THIS CODE SHOULD NOT BE USED TO DIAGNOSE ANY KIND OF MEDICAL CONDITION.
 
 
Authors in chronological order of contribution:
Tim Riedel
Sofia Williams
 
Further Information:
http://diystream.cns.utexas.edu/

Research Educator:
Timothy Riedel
triedel@utexas.edu
 
Brief Description of Goal of Code:
The Goal of this code is to help individuals self diagnose if they have hearing loss. This code should not be a definitive diagnosis, but could help people seek help should they need it. 
 
Known Issues:
Sound is making weird cut off noise and slider isn't tied to audio yet
-->

   <head> 
      
	   <title>Hello World</title>  
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <link rel="stylesheet" href="w3.css">
      <link rel="stylesheet" href="w3-colors-flat.css">
   </head> 


<script>
	
	
	//imported decibel functions
	function dBFSToGain(dbfs) {  
  	return Math.pow(10, dbfs / 20);
	}
	 
	
	function decibel(freq, decibel,ear){
	let audioCtx = new AudioContext()

	// Create nodes
	let osc = audioCtx.createOscillator()
	let gain = audioCtx.createGain()

	// Set parameters
	osc.frequency.value = freq
	gain.gain.value = decibel
	
	// Schedule parameter changes
	
	// Drop to -12 dBFS at ~1s
	gain.gain.setValueAtTime(1, 1 - 0.03);
	gain.gain.linearRampToValueAtTime(dBFSToGain(-12), 3) //changed gain 
		
	//Creating Stereo Panner to Output on L Headphone
	var panNode = audioCtx.createStereoPanner()
	panNode.pan.value = ear
	
	//Connect graph
	osc.connect(gain)
	gain.connect(panNode)
	panNode.connect(audioCtx.destination) 
	
	// Schedule start and stop
	//osc.start()
		osc.start(0)
		panNode.gain.exponentialRampToValueAtTime(
 		0.00001, context.currentTime + 5)
	osc.stop(audioCtx.currentTime + 5)
	}
	
</script>
<style>	
.body {
     margin: 0em;
}

.page {
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: -100vw;
    overflow-y: auto;
    z-index: 0;
    background-color: hsl(0,0%,100%);
}

  .page:target {
    left: 0vw;
    z-index: 1;
}
</style>
<style>	
	.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 25px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}
</style>
</head>
	<body>
<div id="header" class="w3-container w3-flat-peter-river">
	<h1>Audiogram Test</h1>
</div>
	
<div id="content" class="w3-container">
	<p>This audiogram exam will help find out if you may have hearing loss and help to tell you the extent of your hearing loss. In order to perform this exam, 
	follow all of the instructions listed below: </p>
	<p> 1. Try to take this test in as quiet of an environment as possible for optimal results. </p>
	<p> 2. This exam must be used with headphones in order to detect changes in the left/right ear. Use the highest quality of headphones that you have to take this test. </p>
	<p> 3. Turn your device's volume to the maximum volume setting. The app will not play sounds as loud as the device's full amplitude, but uses this as a scale to calibrate accurate decibel outputs. </p>
	 <a href="#one" class="w3-btn w3-grey w3-round"> Get Started </a>
	<br> 
	<br>
	<br>
	<br>
	<br> 
	<br>
	<br>
	<br>
	<br>
	<br>
	<p style="color:black;font-size:12px;">The following code has been developed by students and/or researchers of the Freshman Research Initiative DIY Diagnostics Stream at The University of Texas at 		Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only. Any user of this code 			does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.</p>
	<p style="color:black;font-size:12px;">THIS CODE SHOULD NOT BE USED TO DIAGNOSE ANY KIND OF MEDICAL CONDITION.</p>

<div class="page" id="one">
	<div id="header" class="w3-container w3-flat-peter-river">
		<h1>Audiogram Test</h1>
	</div>
	
    	<div id="content" class="w3-container">
	
	<div class="slidecontainer">
 	<p>Use the Slider Below to Adjust the Audio Level:</p>
  	<input type="range" min="1" max="100" value="0" id="myRange">
	<p>Value: <span id="demo"></span></p>
	</div>
		<script>
	var slider = document.getElementById("myRange");
	var output = document.getElementById("demo");
	output.innerHTML = slider.value;

	//slider.oninput = function() { -->
  	//output.innerHTML = this.value;
	//} 
	slider.oninput = decibel(440,1,-1)
</script>
		
	<p> Where were you able to hear the sound? </p> 
	<a href="#two" onclick="yesAdd1();" class="w3-btn w3-black"> Left </a><!--button adds one to yes count-->	
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> Right </a><!--button adds one to no count-->
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> Neither </a><!--button adds one to no count-->
    	</div>
</div>
	<div class="page" id="two">
	<div id="header" class="w3-container w3-flat-peter-river">
		<h1>Audiogram Test</h1>
	</div>
	
    	<div id="content" class="w3-container">
        <p>Press the button below to hear the first sound. </p>    
	<a href="#one" onclick="decibel(440,1,-1);" class="w3-btn w3-black"> Play </a><!--button starts beeping noise-->
	
	<p> Where did you hear the sound? </p> 
	<a href="#two" onclick="yesAdd1();" class="w3-btn w3-black"> Left </a><!--button adds one to yes count-->	
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> Right </a><!--button adds one to no count-->
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> Neither </a><!--button adds one to no count-->
    	</div>
</div>
	</div>
	<div class="page" id="three">
	<div id="header" class="w3-container w3-flat-peter-river">
		<h1>Audiogram Test</h1>
	</div>
	
    	<div id="content" class="w3-container">
        <p>Press the button below to hear the first sound. </p>    
	<a href="#one" onclick="decibel_R();" class="w3-btn w3-black"> Play </a><!--button starts beeping noise-->
	
	<p> Were you able to hear the sound? </p> 
	<a href="#two" onclick="yesAdd1();" class="w3-btn w3-black"> Yes </a><!--button adds one to yes count-->	
	<a href="#two" onclick="noAdd1();" class="w3-btn w3-black"> No </a><!--button adds one to no count-->
    	</div>
</div>
	<footer class="w3-bottom w3-container w3-flat-peter-river">
	<p>DIY DIAGNOSTICS!</p>
</footer>

</body>
</html>
